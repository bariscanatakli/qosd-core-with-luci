[SERVICE]
    Flush           1
    Daemon          Off
    Log_Level       info
    Parsers_File    parsers.conf
    HTTP_Server     On
    HTTP_Listen     0.0.0.0 
    HTTP_Port       2020
    # Expose metrics endpoint for health checks and capacity planning.

[INPUT]
    Name            forward
    Listen          0.0.0.0
    Port            24224
    Tag             forward.default
    # Collects Fluent Forward streams from Docker logging driver and OpenWrt.

[INPUT]
    Name            syslog
    Mode            udp
    Listen          0.0.0.0
    Port            5514
    Parser          syslog-rfc3164
    Tag             syslog.router
    # Optional syslog input for OpenWrt legacy forwarding.

[FILTER]
    Name            parser
    Match           forward.*
    Key_Name        log
    Parser          docker_json
    Reserve_Data    On
    Preserve_Key    On
    # Promote JSON payloads emitted by Docker logging driver.

[FILTER]
    Name            modify
    Match           forward.*
    Add             pipeline_stage ingestion
    Add             pipeline_input forward
    Add             telemetry_role edge-router

[FILTER]
    Name            parser
    Match           syslog.*
    Key_Name        message
    Parser          docker_json
    Reserve_Data    On
    Preserve_Key    On

[FILTER]
    Name            modify
    Match           syslog.*
    Add             pipeline_stage ingestion
    Add             pipeline_input syslog
    Add             telemetry_role edge-router

[FILTER]
    Name            nest
    Match           forward.*
    Operation       lift
    Nested_under    docker
    Add_prefix      docker.
    # Lift Docker metadata for correlation; router logs simply pass through.

[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch-node
    Port            9200
    Index           my-app-logs
    Logstash_Format On
    Logstash_Prefix my-app-logs
    Logstash_DateFormat %Y.%m.%d
    Suppress_Type_Name On
    Replace_Dots    On
    Generate_ID     On
    Retry_Limit     False

[OUTPUT]
    Name            http
    Match           *
    Host            collector-api
    Port            4000
    URI             /ingest
    Format          json
    Json_Date_Key   @timestamp
    Json_Date_Format iso8601
    Retry_Limit     False
